---

- name: pull alpine container images with redbird
  git: repo=https://github.com/learnlinux/tuxlab-reverse-proxy.git dest=/home/core/tuxlab-reverse-proxy

- name: copying Settings
  become: yes
  become_method: sudo
  template: src=settings.json.j2 dest=/home/core/tuxlab-reverse-proxy/src/settings.json owner=root group=root mode=0644

- name: build tuxlab_proxy image
  become: yes
  become_method: sudo
  docker_image:
    path: /home/core/tuxlab-reverse-proxy
    name: tuxlab_proxy

- name: start reverse proxy container
  docker:
    name: host-proxy
    image: tuxlab_proxy
    tty: yes
    publish_all_ports: yes
    stdin_open: yes
    command: "/usr/bin/node /root/proxies.js"
