---
  - name: Ensure Appropriate SSH Port
    hosts: tuxlab-swarm-host
    gather_facts: no
    tasks:
      - set_fact:
          ansible_port: 2222

  - name: Validate ETCD Cluster
    hosts: all
    tasks:
      - shell: etcdctl cluster-health
        register: result

      - debug:
          verbosity: 2
          var: result.stdout

      - shell: etcdctl cluster-health > /dev/null; echo $?
        register: result

      - assert:
          that:
            - "result.stdout == 0"
          msg: "etcdctl reported an unhealthy cluster"

  - name: Validate Docker Swarm
    hosts: tuxlab-swarm-manager
    tasks:

      - shell: docker -H {{ ansible_host }}:4000 info
        become: yes
        register: result

      - debug:
          var: result.stdout

  - name: Validate Proxy
    hosts: tuxlab-swarm-host
    tasks:

      - shell: etcdctl ls
      - debug:
          var: result.stdout
