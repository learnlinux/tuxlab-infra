---
  - include_vars: aws/vars/ec2_tower_callback.yml

  - name: Create Swarm Manager
    ec2:
      image: "{{SWARM_IMAGE}}"
      instance_type: "{{SWARM_INSTANCE_TYPE}}"
      region: "{{ EC2_REGION }}"
      assign_public_ip: yes
      vpc_subnet_id: "{{ vpc.subnets[0].id }}"
      key_name: "tuxlab"
      group_id: ["{{docker_manager_sec_group.group_id}}", "{{ansible_sec_group.group_id}}", "{{etcd_sec_group.group_id}}"]
      instance_tags:
          Name: Swarm Manager
      wait: yes
    register: docker_swarm_instance

  - name: Add Swarm Manager to Hosts
    add_host:
         name="docker_swarm_manager"
         group="docker_swarm_manager"
         swarm_node_ip="{{item.private_ip}}"
    with_items: "{{ docker_swarm_instance.instances }}"
